{
	"name": "FlowCatalogueToSQL",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CSVCustomField",
						"type": "DatasetReference"
					},
					"name": "source1"
				},
				{
					"dataset": {
						"referenceName": "CSVChange",
						"type": "DatasetReference"
					},
					"name": "source2"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "Output",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "DeleteOtherColumn"
				},
				{
					"name": "Select1"
				},
				{
					"name": "ExcludeExtrenalRefNULL"
				},
				{
					"name": "filter1"
				},
				{
					"name": "AddSinatureNew"
				},
				{
					"name": "AddSignatureOld"
				},
				{
					"name": "exists1"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"parameters{",
				"     Filename as string",
				"}",
				"source(output(",
				"          {Internal reference} as string,",
				"          {External reference} as string,",
				"          Name as string,",
				"          Description as string,",
				"          {Content Type} as string,",
				"          {Display type} as string,",
				"          {Created on} as timestamp,",
				"          Priority as string,",
				"          {Enrolment mode} as string,",
				"          {Enrolment count} as short,",
				"          {CPD learning hours} as string,",
				"          {CPD points} as string,",
				"          {Access count} as short,",
				"          {Rating mean} as string,",
				"          {Rating count} as string,",
				"          {Visibility:phone} as string,",
				"          {Visibility:tablet} as string,",
				"          {Visibility:portal} as string,",
				"          Category18 as string,",
				"          Category19 as string,",
				"          Category20 as string,",
				"          Category21 as string,",
				"          Category22 as string,",
				"          Category23 as string,",
				"          Category24 as string,",
				"          Category25 as string,",
				"          Category26 as string,",
				"          Category27 as string,",
				"          Category28 as string,",
				"          Category29 as string,",
				"          Category30 as string,",
				"          Category31 as string,",
				"          Category32 as string,",
				"          Category33 as string,",
				"          Category34 as string,",
				"          Category35 as string,",
				"          Category36 as string,",
				"          Category37 as string,",
				"          Category38 as string,",
				"          Category39 as string,",
				"          Category40 as string,",
				"          Category41 as string,",
				"          Category42 as string,",
				"          Category43 as string,",
				"          Category44 as string,",
				"          Category45 as string,",
				"          Category46 as string,",
				"          Category47 as string,",
				"          Category48 as string,",
				"          Category49 as string,",
				"          Category50 as string,",
				"          Category51 as string,",
				"          Category52 as string,",
				"          Category53 as string,",
				"          Category54 as string,",
				"          Category55 as string,",
				"          Category56 as string,",
				"          Category57 as string,",
				"          Category58 as string,",
				"          Category59 as string,",
				"          Category60 as string,",
				"          Category61 as string,",
				"          Category62 as string,",
				"          Category63 as string,",
				"          Category64 as string,",
				"          Category65 as string,",
				"          Category66 as string,",
				"          Category67 as string,",
				"          Category68 as string,",
				"          Category69 as string,",
				"          Category70 as string,",
				"          Category71 as string,",
				"          Category72 as string,",
				"          Category73 as string,",
				"          Category74 as string,",
				"          Category75 as string,",
				"          Category76 as string,",
				"          Category77 as string,",
				"          Category78 as string,",
				"          Category79 as string,",
				"          Category80 as string,",
				"          Category81 as string,",
				"          Category82 as string,",
				"          Category83 as string,",
				"          Category84 as string,",
				"          Category85 as string,",
				"          Category86 as string,",
				"          Category87 as string,",
				"          Category88 as string,",
				"          Category89 as string,",
				"          Category90 as string,",
				"          Category91 as string,",
				"          Category92 as string,",
				"          Category93 as string,",
				"          Category94 as string,",
				"          Category95 as string,",
				"          Category96 as string,",
				"          Category97 as string,",
				"          Category98 as string,",
				"          Category99 as string,",
				"          Category100 as string,",
				"          Category101 as string,",
				"          Category102 as string,",
				"          Category103 as string,",
				"          Category104 as string,",
				"          Category105 as string,",
				"          Category106 as string,",
				"          Category107 as string,",
				"          Category108 as string,",
				"          Category109 as string,",
				"          Category110 as string,",
				"          Category111 as string,",
				"          Category112 as string,",
				"          Category113 as string,",
				"          Category114 as string,",
				"          Category115 as string,",
				"          Category116 as string,",
				"          Category117 as string,",
				"          Category118 as string,",
				"          Category119 as string,",
				"          Category120 as string,",
				"          Category121 as string,",
				"          Category122 as string,",
				"          Category123 as string,",
				"          Category124 as string,",
				"          Category125 as string,",
				"          Category126 as string,",
				"          Category127 as string,",
				"          Category128 as string,",
				"          Category129 as string,",
				"          Category130 as string,",
				"          Category131 as string,",
				"          Category132 as string,",
				"          Category133 as string,",
				"          Category134 as string,",
				"          Category135 as string,",
				"          Category136 as string,",
				"          Category137 as string,",
				"          Category138 as string,",
				"          Category139 as string,",
				"          Category140 as string,",
				"          Category141 as string,",
				"          Category142 as string,",
				"          Category143 as string,",
				"          Category144 as string,",
				"          Category145 as string,",
				"          Category146 as string,",
				"          Category147 as string,",
				"          {Catalogue:group148} as string,",
				"          {Catalogue:group149} as string,",
				"          {Catalogue:group150} as string,",
				"          {Catalogue:group151} as string,",
				"          {Catalogue:group152} as string,",
				"          {Catalogue:group153} as string,",
				"          {Catalogue:group154} as string,",
				"          {Catalogue:group155} as string,",
				"          {My learning:group156} as string,",
				"          {My learning:group157} as string,",
				"          {My learning:group158} as string,",
				"          {My learning:group159} as string,",
				"          {My learning:group160} as string,",
				"          {My learning:group161} as string,",
				"          {My learning:group162} as string,",
				"          {My learning:group163} as string,",
				"          {My learning:group164} as string,",
				"          {My learning:group165} as string,",
				"          {Catalogue:ou:business unit description (english)166} as string,",
				"          {Catalogue:ou:business unit description (english)167} as string,",
				"          {Catalogue:ou:business unit description (english)168} as string,",
				"          {Catalogue:ou:business unit description (english)169} as string,",
				"          {Catalogue:ou:business unit description (english)170} as string,",
				"          {Catalogue:ou:business unit description (english)171} as string,",
				"          {Catalogue:ou:business unit description (english)172} as string,",
				"          {Catalogue:ou:business unit description (english)173} as string,",
				"          {Catalogue:ou:business unit description (english)174} as string,",
				"          {Catalogue:ou:business unit description (english)175} as string,",
				"          {Catalogue:ou:business unit description (english)176} as string,",
				"          {Catalogue:ou:business unit description (english)177} as string,",
				"          {Catalogue:ou:business unit description (english)178} as string,",
				"          {Catalogue:ou:business unit description (english)179} as string,",
				"          {Catalogue:ou:business unit description (english)180} as string,",
				"          {Catalogue:ou:business unit description (english)181} as string,",
				"          {Catalogue:ou:business unit description (english)182} as string,",
				"          {Catalogue:ou:business unit description (english)183} as string,",
				"          {Catalogue:ou:business unit description (english)184} as string,",
				"          {Catalogue:ou:business unit description (english)185} as string,",
				"          {Catalogue:ou:business unit description (english)186} as string,",
				"          {Catalogue:ou:business unit description (english)187} as string,",
				"          {Catalogue:ou:business unit description (english)188} as string,",
				"          {Catalogue:ou:business unit description (english)189} as string,",
				"          {Catalogue:ou:business unit description (english)190} as string,",
				"          {Catalogue:ou:business unit description (english)191} as string,",
				"          {Catalogue:ou:business unit description (english)192} as string,",
				"          {Catalogue:ou:business unit description (local)193} as string,",
				"          {Catalogue:ou:business unit description (local)194} as string,",
				"          {Catalogue:ou:business unit description (local)195} as string,",
				"          {Catalogue:ou:business unit description (local)196} as string,",
				"          {My learning:ou:business unit description (english)197} as string,",
				"          {My learning:ou:business unit description (english)198} as string,",
				"          {My learning:ou:business unit description (english)199} as string,",
				"          {My learning:ou:business unit description (english)200} as string,",
				"          {My learning:ou:business unit description (english)201} as string,",
				"          {My learning:ou:business unit description (english)202} as string,",
				"          {My learning:ou:business unit description (english)203} as string,",
				"          {My learning:ou:business unit description (english)204} as string,",
				"          {My learning:ou:business unit description (english)205} as string,",
				"          {My learning:ou:business unit description (english)206} as string,",
				"          {My learning:ou:business unit description (english)207} as string,",
				"          {My learning:ou:business unit description (english)208} as string,",
				"          {My learning:ou:business unit description (local)} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     multiLineRow: true) ~> source1",
				"source(output(",
				"          Column_1 as string,",
				"          Column_2 as string,",
				"          Column_3 as string,",
				"          Column_4 as string,",
				"          Column_5 as string,",
				"          Column_6 as string,",
				"          Column_7 as string,",
				"          Column_8 as string,",
				"          Column_9 as string,",
				"          Column_10 as string,",
				"          Column_11 as string,",
				"          Column_12 as string,",
				"          Column_13 as string,",
				"          Column_14 as string,",
				"          Column_15 as string,",
				"          Column_16 as string,",
				"          Column_17 as string,",
				"          Column_18 as string,",
				"          Column_19 as string,",
				"          Column_20 as string,",
				"          Column_21 as string,",
				"          Column_22 as string,",
				"          Column_23 as string,",
				"          Column_24 as string,",
				"          Column_25 as string,",
				"          Column_26 as string,",
				"          Column_27 as string,",
				"          Column_28 as string,",
				"          Column_29 as string,",
				"          Column_30 as string,",
				"          Column_31 as string,",
				"          Column_32 as string,",
				"          Column_33 as string,",
				"          Column_34 as string,",
				"          Column_35 as string,",
				"          Column_36 as string,",
				"          Column_37 as string,",
				"          Column_38 as string,",
				"          Column_39 as string,",
				"          Column_40 as string,",
				"          Column_41 as string,",
				"          Column_42 as string,",
				"          Column_43 as string,",
				"          Column_44 as string,",
				"          Column_45 as string,",
				"          Column_46 as string,",
				"          Column_47 as string,",
				"          Column_48 as string,",
				"          Column_49 as string,",
				"          Column_50 as string,",
				"          Column_51 as string,",
				"          Column_52 as string,",
				"          Column_53 as string,",
				"          Column_54 as string,",
				"          Column_55 as string,",
				"          Column_56 as string,",
				"          Column_57 as string,",
				"          Column_58 as string,",
				"          Column_59 as string,",
				"          Column_60 as string,",
				"          Column_61 as string,",
				"          Column_62 as string,",
				"          Column_63 as string,",
				"          Column_64 as string,",
				"          Column_65 as string,",
				"          Column_66 as string,",
				"          Column_67 as string,",
				"          Column_68 as string,",
				"          Column_69 as string,",
				"          Column_70 as string,",
				"          Column_71 as string,",
				"          Column_72 as string,",
				"          Column_73 as string,",
				"          Column_74 as string,",
				"          Column_75 as string,",
				"          Column_76 as string,",
				"          Column_77 as string,",
				"          Column_78 as string,",
				"          Column_79 as string,",
				"          Column_80 as string,",
				"          Column_81 as string,",
				"          Column_82 as string,",
				"          Column_83 as string,",
				"          Column_84 as string,",
				"          Column_85 as string,",
				"          Column_86 as string,",
				"          Column_87 as string,",
				"          Column_88 as string,",
				"          Column_89 as string,",
				"          Column_90 as string,",
				"          Column_91 as string,",
				"          Column_92 as string,",
				"          Column_93 as string,",
				"          Column_94 as string,",
				"          Column_95 as string,",
				"          Column_96 as string,",
				"          Column_97 as string,",
				"          Column_98 as string,",
				"          Column_99 as string,",
				"          Column_100 as string,",
				"          Column_101 as string,",
				"          Column_102 as string,",
				"          Column_103 as string,",
				"          Column_104 as string,",
				"          Column_105 as string,",
				"          Column_106 as string,",
				"          Column_107 as string,",
				"          Column_108 as string,",
				"          Column_109 as string,",
				"          Column_110 as string,",
				"          Column_111 as string,",
				"          Column_112 as string,",
				"          Column_113 as string,",
				"          Column_114 as string,",
				"          Column_115 as string,",
				"          Column_116 as string,",
				"          Column_117 as string,",
				"          Column_118 as string,",
				"          Column_119 as string,",
				"          Column_120 as string,",
				"          Column_121 as string,",
				"          Column_122 as string,",
				"          Column_123 as string,",
				"          Column_124 as string,",
				"          Column_125 as string,",
				"          Column_126 as string,",
				"          Column_127 as string,",
				"          Column_128 as string,",
				"          Column_129 as string,",
				"          Column_130 as string,",
				"          Column_131 as string,",
				"          Column_132 as string,",
				"          Column_133 as string,",
				"          Column_134 as string,",
				"          Column_135 as string,",
				"          Column_136 as string,",
				"          Column_137 as string,",
				"          Column_138 as string,",
				"          Column_139 as string,",
				"          Column_140 as string,",
				"          Column_141 as string,",
				"          Column_142 as string,",
				"          Column_143 as string,",
				"          Column_144 as string,",
				"          Column_145 as string,",
				"          Column_146 as string,",
				"          Column_147 as string,",
				"          Column_148 as string,",
				"          Column_149 as string,",
				"          Column_150 as string,",
				"          Column_151 as string,",
				"          Column_152 as string,",
				"          Column_153 as string,",
				"          Column_154 as string,",
				"          Column_155 as string,",
				"          Column_156 as string,",
				"          Column_157 as string,",
				"          Column_158 as string,",
				"          Column_159 as string,",
				"          Column_160 as string,",
				"          Column_161 as string,",
				"          Column_162 as string,",
				"          Column_163 as string,",
				"          Column_164 as string,",
				"          Column_165 as string,",
				"          Column_166 as string,",
				"          Column_167 as string,",
				"          Column_168 as string,",
				"          Column_169 as string,",
				"          Column_170 as string,",
				"          Column_171 as string,",
				"          Column_172 as string,",
				"          Column_173 as string,",
				"          Column_174 as string,",
				"          Column_175 as string,",
				"          Column_176 as string,",
				"          Column_177 as string,",
				"          Column_178 as string,",
				"          Column_179 as string,",
				"          Column_180 as string,",
				"          Column_181 as string,",
				"          Column_182 as string,",
				"          Column_183 as string,",
				"          Column_184 as string,",
				"          Column_185 as string,",
				"          Column_186 as string,",
				"          Column_187 as string,",
				"          Column_188 as string,",
				"          Column_189 as string,",
				"          Column_190 as string,",
				"          Column_191 as string,",
				"          Column_192 as string,",
				"          Column_193 as string,",
				"          Column_194 as string,",
				"          Column_195 as string,",
				"          Column_196 as string,",
				"          Column_197 as string,",
				"          Column_198 as string,",
				"          Column_199 as string,",
				"          Column_200 as string,",
				"          Column_201 as string,",
				"          Column_202 as string,",
				"          Column_203 as string,",
				"          Column_204 as string,",
				"          Column_205 as string,",
				"          Column_206 as string,",
				"          Column_207 as string,",
				"          Column_208 as string,",
				"          Column_209 as string,",
				"          Column_210 as string,",
				"          Column_211 as string,",
				"          Column_212 as string,",
				"          Column_213 as string,",
				"          Column_214 as string,",
				"          Column_215 as string,",
				"          Column_216 as string,",
				"          Column_217 as string,",
				"          Column_218 as string,",
				"          Column_219 as string,",
				"          Column_220 as string,",
				"          Column_221 as string,",
				"          Column_222 as string,",
				"          Column_223 as string,",
				"          Column_224 as string,",
				"          Column_225 as string,",
				"          Column_226 as string,",
				"          Column_227 as string,",
				"          Column_228 as string,",
				"          Column_229 as string,",
				"          Column_230 as string,",
				"          Column_231 as string,",
				"          Column_232 as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     multiLineRow: true) ~> source2",
				"source1 select(mapColumn(",
				"          each(match(name=='Internal reference'||name=='External reference'||name=='Name'||name=='Description'||name=='Description'||name=='Display type'||name=='Created on'||name=='Priority'||name=='Created on'||name=='Priority'||name=='Enrolment mode'||name=='Enrolment count'||name=='CPD learning hours'||name=='CPD points'||name=='Access count'||name=='Rating mean'||name=='Rating count'||name=='Visibility:phone'||name=='Visibility:tablet'||name=='Visibility:portal'))",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> DeleteOtherColumn",
				"source2 select(mapColumn(",
				"          each(match(name=='Internal reference'||name=='External reference'||name=='Name'||name=='Description'||name=='Description'||name=='Display type'||name=='Created on'||name=='Priority'||name=='Created on'||name=='Priority'||name=='Enrolment mode'||name=='Enrolment count'||name=='CPD learning hours'||name=='CPD points'||name=='Access count'||name=='Rating mean'||name=='Rating count'||name=='Visibility:phone'||name=='Visibility:tablet'||name=='Visibility:portal'))",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> Select1",
				"DeleteOtherColumn filter(!isNull({External reference})) ~> ExcludeExtrenalRefNULL",
				"Select1 filter(!isNull({External reference})) ~> filter1",
				"ExcludeExtrenalRefNULL derive(SignatureNew = sha2(256,columns())) ~> AddSinatureNew",
				"filter1 derive(SignatureOld = sha2(256,columns())) ~> AddSignatureOld",
				"AddSinatureNew, AddSignatureOld exists(SignatureNew == SignatureOld,",
				"     negate:true,",
				"     broadcast: 'auto')~> exists1",
				"exists1 derive(UpdateDate = currentUTC(),",
				"          FromFile = toString($Filename)) ~> derivedColumn1",
				"derivedColumn1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     filePattern:(concat('Catalogue-Export_', toString(currentTimestamp(), 'yyyyMMddHHmmss'), '.csv')),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sink1"
			]
		}
	}
}